## TR

## A kernel you can boot via GRUB

—Å–æ–∑–¥–∞—Ç—å —Å–≤–æ–π —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π  kernel binary file(–Ω–∞–ø—Ä–∏–º–µ—Ä, mykernel.bin), –∫–æ—Ç–æ—Ä—ã–π:

* –º–æ–∂–µ—Ç –±—ã—Ç—å –ø–æ–º–µ—â–µ–Ω –≤ –ø–∞–ø–∫—É /boot/ –¥–∏—Å–∫–∞ –∏–ª–∏ ISO-–æ–±—Ä–∞–∑–∞,

* –º–æ–∂–µ—Ç –±—ã—Ç—å –∑–∞–≥—Ä—É–∂–µ–Ω –∏ –∑–∞–ø—É—â–µ–Ω GRUB (–∑–∞–≥—Ä—É–∑—á–∏–∫–æ–º),

–í—ã –Ω–∞–ø–∏—à–µ—Ç–µ –ø—Ä–æ—Å—Ç–æ–µ kernel ‚Äã‚Äã¬´–º–∏–Ω–∏-–æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã¬ª, –∫–æ—Ç–æ—Ä–æ–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–µ—Ç GRUB (–∏—Å–ø–æ–ª—å–∑—É—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç Multiboot), —á—Ç–æ–±—ã GRUB –º–æ–≥ –∑–∞–≥—Ä—É–∑–∏—Ç—å –µ–≥–æ –≤ –ø–∞–º—è—Ç—å –∏ –ø–µ—Ä–µ–π—Ç–∏ –∫ –≤–∞—à–µ–º—É –∫–æ–¥—É.

## An ASM bootable base

–≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –≤–∞–º –Ω—É–∂–Ω–æ –Ω–∞–ø–∏—Å–∞—Ç—å –Ω–µ–±–æ–ª—å—à–æ–π —Ñ—Ä–∞–≥–º–µ–Ω—Ç –∫–æ–¥–∞ –Ω–∞ –∞—Å—Å–µ–º–±–ª–µ—Ä–µ, –∫–æ—Ç–æ—Ä—ã–π:

–ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø–µ—Ä–≤—ã–º, –∫–æ–≥–¥–∞ GRUB –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –∫ kernel,

–ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å—Ç–µ–∫, —Å–µ–≥–º–µ–Ω—Ç–Ω—ã–µ —Ä–µ–≥–∏—Å—Ç—Ä—ã, –≤–æ–∑–º–æ–∂–Ω–æ, –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç—Å—è –≤ 32-–±–∏—Ç–Ω—ã–π —Ä–µ–∂–∏–º –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏),
–ê –∑–∞—Ç–µ–º –≤—ã–∑—ã–≤–∞–µ—Ç –≤–∞—à –∫–æ–¥ –Ω–∞ C (–æ—Å–Ω–æ–≤–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é lernel).

–ü–æ—á–µ–º—É ASM?
–ü–æ—Ç–æ–º—É —á—Ç–æ –∫–æ–≥–¥–∞ GRUB –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –∫ —è–¥—Ä—É, –æ–Ω –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –≤–∞–º —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ –æ—á–µ–Ω—å –Ω–∏–∑–∫–æ–º —É—Ä–æ–≤–Ω–µ. –ü—Ä–µ–∂–¥–µ —á–µ–º –≤—ã —Å–º–æ–∂–µ—Ç–µ –∫–æ–º—Ñ–æ—Ä—Ç–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å C, –≤–∞–º –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –æ–∫—Ä—É–∂–µ–Ω–∏–µ. –û–±—ã—á–Ω–æ —ç—Ç–æ –Ω–µ–±–æ–ª—å—à–æ–π —Ñ–∞–π–ª, –Ω–∞–ø—Ä–∏–º–µ—Ä, boot.asm –∏–ª–∏ entry.asm.

`bootable base` ASM ‚Äî —ç—Ç–æ –≤—Ö–æ–¥–Ω–∞—è –¥–≤–µ—Ä—å –≤ kernel. –û–Ω–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ –≤—Å–µ –≥–æ—Ç–æ–≤–æ –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º C-–∫–æ–¥–∞ –≤–∞—à–µ–≥–æ kernel.

## A basic kernel library, with basic functions and types

–ü—Ä–∏ –Ω–∞–ø–∏—Å–∞–Ω–∏–∏ kernel-–∞ –≤—ã –Ω–µ –º–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—É—é –±–∏–±–ª–∏–æ—Ç–µ–∫—É C (printf, malloc –∏ —Ç. –¥.), –ø–æ—Ç–æ–º—É —á—Ç–æ –æ–Ω–∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—é—Ç—Å—è –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º–æ–π... –∞ –º—ã —Ç–µ–ø–µ—Ä—å –∏ –µ—Å—Ç—å –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞. ü¶ä

–ò—Ç–∞–∫, –Ω–∞–º –Ω—É–∂–Ω–æ –Ω–∞–ø–∏—Å–∞—Ç—å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—É—é –Ω–µ–±–æ–ª—å—à—É—é –±–∏–±–ª–∏–æ—Ç–µ–∫—É-–∑–∞–º–µ–Ω–∏—Ç–µ–ª—å, —á–∞—Å—Ç–æ –Ω–∞–∑—ã–≤–∞–µ–º—É—é libk –∏–ª–∏ klib (–±–∏–±–ª–∏–æ—Ç–µ–∫–∞ —è–¥—Ä–∞). –û–±—ã—á–Ω–æ –æ–Ω–∞ –≤–∫–ª—é—á–∞–µ—Ç –≤ —Å–µ–±—è:

–ë–∞–∑–æ–≤—ã–µ —Ç–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö, —Ç–∞–∫–∏–µ –∫–∞–∫ uint8_t, uint16_t, size_t (–ø–æ—Å–∫–æ–ª—å–∫—É –≤ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö —Å–ª—É—á–∞—è—Ö –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å <stdint.h>);

–°—Ç—Ä–æ–∫–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏: memcpy, memset, strlen –∏ —Ç. –¥.

–í–æ–∑–º–æ–∂–Ω–æ, –ø—Ä–æ—Å—Ç—ã–µ –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏.

–≠—Ç–æ –¥–∞—ë—Ç –Ω–∞–º –æ—Å–Ω–æ–≤—É –¥–ª—è –º–Ω–æ–≥–æ–∫—Ä–∞—Ç–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∫–æ–¥–∞, —á—Ç–æ–±—ã –Ω–∞–º –Ω–µ –ø—Ä–∏—Ö–æ–¥–∏–ª–æ—Å—å –∫–∞–∂–¥—ã–π —Ä–∞–∑ –ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞—Ç—å –ø—Ä–æ—Å—Ç—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏.

kernel library  ‚Äî —ç—Ç–æ –Ω–∞–±–æ—Ä –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ üß∞ ‚Äî –ø—Ä–µ–∂–¥–µ —á–µ–º —Å—Ç—Ä–æ–∏—Ç—å –¥–æ–º, –≤–∞–º –Ω—É–∂–Ω–æ –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å –æ—Å–Ω–æ–≤–Ω—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã.


## 4. ‚ÄúSome basic code to print some stuff on the screen‚Äù

–≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –º—ã –Ω–∞–ø–∏—à–µ–º –∫–æ–¥, –∫–æ—Ç–æ—Ä—ã–π —Å–º–æ–∂–µ—Ç –Ω–∞–ø—Ä—è–º—É—é –≤—ã–≤–æ–¥–∏—Ç—å —Ç–µ–∫—Å—Ç –Ω–∞ —ç–∫—Ä–∞–Ω, –∏—Å–ø–æ–ª—å–∑—É—è —Ç–µ–∫—Å—Ç–æ–≤—ã–π –±—É—Ñ–µ—Ä VGA (–≤ —Å–∏—Å—Ç–µ–º–∞—Ö x86).

–ü–æ—Å–∫–æ–ª—å–∫—É —É –Ω–∞—Å –Ω–µ—Ç –Ω–∏ –û–°, –Ω–∏ –≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏—Ö –¥—Ä–∞–π–≤–µ—Ä–æ–≤, —Å–∞–º—ã–π –ø—Ä–æ—Å—Ç–æ–π —Å–ø–æ—Å–æ–± ‚Äî –∑–∞–ø–∏—Å—ã–≤–∞—Ç—å —Å–∏–º–≤–æ–ª—ã –Ω–µ–ø–æ—Å—Ä–µ–¥—Å—Ç–≤–µ–Ω–Ω–æ –≤ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—É—é –æ–±–ª–∞—Å—Ç—å –ø–∞–º—è—Ç–∏ –ø–æ –∞–¥—Ä–µ—Å—É 0xB8000. –ö–∞–∂–¥–∞—è –ø–∞—Ä–∞ –±–∞–π—Ç–æ–≤ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç –æ–¥–∏–Ω —Å–∏–º–≤–æ–ª –∏ –µ–≥–æ —Ü–≤–µ—Ç.

–ù–∞–ø—Ä–∏–º–µ—Ä, –Ω–∞ —è–∑—ã–∫–µ C:

``` c
char* vga = (char*)0xB8000;
vga[0] = 'H';
vga[1] = 0x07;
```

–≠—Ç–æ –≤—ã–≤–µ–¥–µ—Ç –±—É–∫–≤—É ¬´H¬ª –≤ –ª–µ–≤–æ–º –≤–µ—Ä—Ö–Ω–µ–º —É–≥–ª—É —ç–∫—Ä–∞–Ω–∞. –°–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ, –≤—ã —Å–æ–∑–¥–∞–¥–∏—Ç–µ –Ω–µ–±–æ–ª—å—à—É—é —Ñ—É–Ω–∫—Ü–∏—é print() –∏–ª–∏ printf(), –∫–æ—Ç–æ—Ä–∞—è –±—É–¥–µ—Ç –≤—ã–≤–æ–¥–∏—Ç—å —Å—Ç—Ä–æ–∫–∏ –Ω–∞ —ç–∫—Ä–∞–Ω, –Ω–∞–ø—Ä–∏–º–µ—Ä:

``` c
print("Hello kernel!");
```
kernel —É—á–∏—Ç—Å—è ¬´—Å–∫–∞–∑—ã–≤–∞—Ç—å¬ª —á—Ç–æ-–ª–∏–±–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é —Å –ø–æ–º–æ—â—å—é —ç–∫—Ä–∞–Ω–∞.

## A basic "Hello world" kernel



# –ù–∞–º –Ω—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å —è–¥—Ä–æ, –∑–∞–≥—Ä—É–∂–∞–µ–º–æ–µ —Å –ø–æ–º–æ—â—å—é GRUB, –∫–æ—Ç–æ—Ä–æ–µ –º–æ–∂–µ—Ç –≤—ã–≤–æ–¥–∏—Ç—å —Å–∏–º–≤–æ–ª—ã –Ω–∞ —ç–∫—Ä–∞–Ω.
–î–ª—è —ç—Ç–æ–≥–æ –Ω–∞–º –Ω—É–∂–Ω–æ:

* –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å GRUB –Ω–∞ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–∑

* –Ω–∞–ø–∏—à–µ–º  ASM boot code, –∫–æ—Ç–æ—Ä—ã–π –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫ –º—É–ª—å—Ç–∏–∑–∞–≥—Ä—É–∑–∫–∏ –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç GRUB –¥–ª—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∏ –≤—ã–∑–æ–≤–∞ –æ—Å–Ω–æ–≤–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ —Å–∞–º–æ–≥–æ kernel–∞.

* –ù–∞–ø–∏—Å–∞—Ç—å –±–∞–∑–æ–≤—ã–π –∫–æ–¥ kernel–∞ –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —è–∑—ã–∫–∞.
* –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞—Ç—å –µ–≥–æ —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ —Ñ–ª–∞–≥–∞–º–∏ –∏ link, —á—Ç–æ–±—ã —Å–¥–µ–ª–∞—Ç—å –µ–≥–æ bootable.

* –ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤—Å–µ—Ö –≤—ã—à–µ–ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω–Ω—ã—Ö —à–∞–≥–æ–≤ –º—ã –º–æ–∂–µ–º –Ω–∞–ø–∏—Å–∞—Ç—å –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏, –Ω–∞–ø—Ä–∏–º–µ—Ä, —Ç–∏–ø—ã —è–¥—Ä–∞
–∏–ª–∏ –±–∞–∑–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ (strlen, strcmp, ...).
* —Ä–∞–±–æ—Ç–∞ –Ω–µ –¥–æ–ª–∂–Ω–∞ –ø—Ä–µ–≤—ã—à–∞—Ç—å 10 –ú–ë.
* –∑–∞–∫–æ–¥–∏—Ä–æ–≤–∞—Ç—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –º–µ–∂–¥—É kernel–æ–º –∏ —ç–∫—Ä–∞–Ω–æ–º.
* –æ—Ç–æ–±—Ä–∞–∑–∏—Ç—å –Ω–∞ —ç–∫—Ä–∞–Ω–µ —á–∏—Å–ª–æ ¬´42¬ª.


–î–ª—è link –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ–∑–¥–∞—Ç—å linker —Ñ–∞–π–ª —Å –ø–æ–º–æ—â—å—é linker-a GNU (ld).